<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce Analytics Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .card-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #666;
            font-size: 0.95em;
        }

        .metric-value {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1em;
        }

        .cluster-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .cluster-title {
            font-size: 1.4em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cluster-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
        }

        .forecast-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .forecast-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .forecast-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .forecast-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            margin-bottom: 30px;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .upload-btn:hover {
            transform: scale(1.05);
        }

        #fileInput {
            display: none;
        }

        .chart-container {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .chart-container img {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }

        footer {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .team-info {
            color: #666;
            font-size: 0.95em;
        }

        .toggle-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            background: #f0f0ff;
            transform: translateY(-2px);
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä E-commerce Analytics Dashboard</h1>
            <p class="subtitle">Customer Segmentation & Sales Forecasting</p>
            <p class="team-info" style="margin-top: 15px;">
                <strong>Team:</strong> Sereno, Page, Dulce, Laudato | 
                <strong>Teacher:</strong> Sir Charlston Sean Gono
            </p>
        </header>

        <div class="upload-section">
            <h2 style="margin-bottom: 15px; color: #333;">üìÅ Load Analysis Data</h2>
            <p style="color: #666; margin-bottom: 20px;">
                Upload the <code>dashboard_data.json</code> file generated from the Jupyter notebook
            </p>
            <input type="file" id="fileInput" accept=".json">
            <label for="fileInput" class="upload-btn">Choose JSON File</label>
        </div>

        <div id="dashboardContent" style="display: none;">
            <!-- Forecast Toggle -->
            <div class="card" style="margin-bottom: 20px; text-align: center;">
                <div class="card-title">üìä Multi-Granularity Forecasting</div>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 15px;">
                    <button class="toggle-btn active" onclick="showForecast('daily')" id="dailyBtn">
                        üìÖ Daily Forecast (Tactical)
                    </button>
                    <button class="toggle-btn" onclick="showForecast('weekly')" id="weeklyBtn">
                        üìà Weekly Forecast (Strategic)
                    </button>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-title" id="forecastTitle">üìà Daily Sales Forecast</div>
                    <div class="metric">
                        <span class="metric-label" id="avgLabel">Average Daily Sales</span>
                        <span class="metric-value" id="avgSales">$0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label" id="projectionLabel">30-Day Projection</span>
                        <span class="metric-value" id="projected30">$0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Uncertainty Range</span>
                        <span class="metric-value" id="uncertaintyRange">¬±0%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Model Accuracy (MAPE)</span>
                        <span class="metric-value" id="mape">0%</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üë• Customer Analytics</div>
                    <div class="metric">
                        <span class="metric-label">Total Customers</span>
                        <span class="metric-value" id="totalCustomers">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Customer Segments</span>
                        <span class="metric-value" id="numClusters">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total Revenue</span>
                        <span class="metric-value" id="totalRevenue">$0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Model R¬≤ Score</span>
                        <span class="metric-value" id="r2Score">0.0000</span>
                    </div>
                </div>
            </div>

            <!-- Customer Segments -->
            <div class="card">
                <div class="card-title">üéØ Customer Segments</div>
                <div id="clusterContainer"></div>
            </div>

            <!-- Sales Forecast Table -->
            <div class="card">
                <div class="card-title" id="forecastTableTitle">üìÖ Next 7 Days Sales Forecast</div>
                <table class="forecast-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Predicted Sales</th>
                            <th>Lower Bound</th>
                            <th>Upper Bound</th>
                            <th>Uncertainty</th>
                        </tr>
                    </thead>
                    <tbody id="forecastTable"></tbody>
                </table>
            </div>

            <!-- Charts Section -->
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-title">üìä Visualizations</div>
                    <p style="color: #666; margin-bottom: 15px;">
                        Charts are saved as PNG files from the notebook:
                    </p>
                    <ul style="color: #666; line-height: 1.8; list-style-position: inside;">
                        <li>rfm_distributions.png</li>
                        <li>elbow_method.png</li>
                        <li>customer_segments_3d.png</li>
                        <li>sales_forecast.png</li>
                        <li>forecast_components.png</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-title">üí° Key Insights</div>
                    <div id="insightsContainer"></div>
                </div>
            </div>
        </div>

        <footer>
            <p class="team-info">
                <strong>Advanced Data Mining for Customer Segmentation and Sales Forecasting</strong><br>
                An Analytics Framework for E-commerce Optimization
            </p>
        </footer>
    </div>

    <script>
        // Auto-load embedded data on page load
        window.addEventListener('DOMContentLoaded', function() {
            const embeddedData = {"cluster_summary":{"Avg_Recency":{"0":252.06,"1":51.03,"2":29.96,"3":16.9},"Avg_Frequency":{"0":1.47,"1":2.32,"2":7.31,"3":16.39},"Avg_Monetary":{"0":409.86,"1":686.81,"2":2745.84,"3":7564.54},"Customer_Count":{"0":1017,"1":2277,"2":768,"3":194}},"forecast_summary":{"avg_daily_sales":21917.68498568127,"max_sales":56698.89857269108,"min_sales":-19495.62799052033,"mape":300388.1452632561,"rmse":30969.586439702613,"total_customers":4256,"num_clusters":4,"total_revenue":8046069.039999998,"projected_30day":657530.5495704381},"cluster_distribution":{"1":2277,"0":1017,"2":768,"3":194},"forecast_next_7days":[{"ds":"2011-12-10","yhat":27410.015925304353,"yhat_lower":12096.248308542394,"yhat_upper":42895.54037152186},{"ds":"2011-12-11","yhat":43232.561627863724,"yhat_lower":28365.796366066406,"yhat_upper":57411.49922871536},{"ds":"2011-12-12","yhat":53689.49373772409,"yhat_lower":37700.490525930945,"yhat_upper":68600.19605309394},{"ds":"2011-12-13","yhat":54680.75137133004,"yhat_lower":40118.66886607178,"yhat_upper":70583.0913012651},{"ds":"2011-12-14","yhat":50553.855403752335,"yhat_lower":35368.83885724403,"yhat_upper":66123.22865445366},{"ds":"2011-12-15","yhat":56698.89857269108,"yhat_lower":40279.75642656124,"yhat_upper":70906.42737373302},{"ds":"2011-12-16","yhat":36850.32560395978,"yhat_lower":21243.09159223397,"yhat_upper":52032.44753570769}]};
            loadDashboard(embeddedData);
        });

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        loadDashboard(data);
                    } catch (error) {
                        alert('Error reading JSON file. Please ensure it\'s valid.');
                        console.error(error);
                    }
                };
                reader.readAsText(file);
            }
        });

        let currentData = null;
        let currentView = 'daily';

        function showForecast(type) {
            currentView = type;
            if (!currentData) return;

            const dailyBtn = document.getElementById('dailyBtn');
            const weeklyBtn = document.getElementById('weeklyBtn');

            if (type === 'daily') {
                dailyBtn.classList.add('active');
                weeklyBtn.classList.remove('active');
                updateForecastView(currentData.daily_forecast, 'Daily', '7 Days', '30-Day Projection');
            } else {
                weeklyBtn.classList.add('active');
                dailyBtn.classList.remove('active');
                updateForecastView(currentData.weekly_forecast, 'Weekly', '4 Weeks', '4-Week Total');
            }
        }

        function updateForecastView(forecast, granularity, period, projectionLabel) {
            document.getElementById('forecastTitle').textContent = `üìà ${granularity} Sales Forecast`;
            document.getElementById('forecastTableTitle').textContent = `üìÖ Next ${period} Sales Forecast`;
            document.getElementById('avgLabel').textContent = `Average ${granularity} Sales`;
            document.getElementById('projectionLabel').textContent = projectionLabel;

            if (granularity === 'Daily') {
                document.getElementById('avgSales').textContent = formatCurrency(forecast.avg_daily_sales);
                document.getElementById('projected30').textContent = formatCurrency(forecast.avg_daily_sales * 30);
            } else {
                document.getElementById('avgSales').textContent = formatCurrency(forecast.avg_weekly_sales);
                const total = forecast.next_4weeks.reduce((sum, w) => sum + w.yhat, 0);
                document.getElementById('projected30').textContent = formatCurrency(total);
            }

            document.getElementById('uncertaintyRange').textContent = `¬±${forecast.uncertainty_pct.toFixed(1)}%`;
            document.getElementById('mape').textContent = forecast.mape.toFixed(2) + '%';
            document.getElementById('r2Score').textContent = forecast.r2.toFixed(4);

            // Update forecast table
            const forecastTable = document.getElementById('forecastTable');
            forecastTable.innerHTML = '';

            const forecastData = granularity === 'Daily' ? forecast.next_7days : forecast.next_4weeks;
            forecastData.forEach(row => {
                const tr = document.createElement('tr');
                const uncertaintyPct = ((row.yhat_upper - row.yhat_lower) / row.yhat) * 100;
                const badgeClass = uncertaintyPct < 30 ? 'badge-success' : uncertaintyPct < 50 ? 'badge-warning' : 'badge-danger';

                tr.innerHTML = `
                    <td>${row.ds}</td>
                    <td><strong>${formatCurrency(row.yhat)}</strong></td>
                    <td>${formatCurrency(row.yhat_lower)}</td>
                    <td>${formatCurrency(row.yhat_upper)}</td>
                    <td><span class="status-badge ${badgeClass}">¬±${uncertaintyPct.toFixed(1)}%</span></td>
                `;
                forecastTable.appendChild(tr);
            });
        }

        function loadDashboard(data) {
            currentData = data;
            document.getElementById('dashboardContent').style.display = 'block';

            // Check if it's multi-granularity data
            if (data.forecast_type === 'multi_granularity') {
                // Show daily forecast by default
                showForecast('daily');
            } else {
                // Legacy single forecast support
                const fs = data.forecast_summary;
                document.getElementById('avgSales').textContent = formatCurrency(fs.avg_daily_sales);
                document.getElementById('projected30').textContent = formatCurrency(fs.projected_30day);
                document.getElementById('uncertaintyRange').textContent = 'N/A';
                document.getElementById('mape').textContent = fs.mape.toFixed(2) + '%';
                document.getElementById('r2Score').textContent = 'N/A';
            }

            // Populate clusters
            const clusterContainer = document.getElementById('clusterContainer');
            clusterContainer.innerHTML = '';
            
            const clusterNames = ['Champion', 'Loyal', 'At Risk', 'Lost'];
            const clusterColors = [
                'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
            ];

            Object.keys(data.cluster_summary.Avg_Recency).forEach((clusterId, index) => {
                const cluster = data.cluster_summary;
                const recency = cluster.Avg_Recency[clusterId];
                const frequency = cluster.Avg_Frequency[clusterId];
                const monetary = cluster.Avg_Monetary[clusterId];
                const count = cluster.Customer_Count[clusterId];

                const totalCustomers = data.summary ? data.summary.total_customers : 
                                      (data.forecast_summary ? data.forecast_summary.total_customers : 4256);

                const clusterCard = document.createElement('div');
                clusterCard.className = 'cluster-card';
                clusterCard.style.background = clusterColors[index % 4];
                clusterCard.innerHTML = `
                    <div class="cluster-title">
                        üéØ Cluster ${clusterId}: ${clusterNames[index % 4]}
                        <span style="margin-left: auto; font-size: 0.8em;">${count} customers</span>
                    </div>
                    <div class="cluster-stats">
                        <div class="stat-box">
                            <div class="stat-label">Avg Recency</div>
                            <div class="stat-value">${Math.round(recency)} days</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Avg Frequency</div>
                            <div class="stat-value">${frequency.toFixed(1)}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Avg Monetary</div>
                            <div class="stat-value">$${monetary.toFixed(0)}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">% of Total</div>
                            <div class="stat-value">${((count / totalCustomers) * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                `;
                clusterContainer.appendChild(clusterCard);
            });

            // Handle insights - only for legacy data
            if (data.forecast_summary) {
                const fs = data.forecast_summary;
                const insightsContainer = document.getElementById('insightsContainer');
                const accuracy = 100 - fs.mape;
                insightsContainer.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Forecast Accuracy</span>
                        <span class="status-badge ${accuracy > 85 ? 'badge-success' : accuracy > 70 ? 'badge-warning' : 'badge-danger'}">
                            ${accuracy.toFixed(1)}%
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Recommended Stock Buffer</span>
                        <span class="metric-value">${formatCurrency(fs.max_sales * 1.2)}</span>
                    </div>
                `;

                // Populate old forecast table
                const forecastTable = document.getElementById('forecastTable');
                forecastTable.innerHTML = '';

                data.forecast_next_7days.forEach(row => {
                    const tr = document.createElement('tr');
                    const uncertaintyPct = ((row.yhat_upper - row.yhat_lower) / row.yhat) * 100;
                    const badgeClass = uncertaintyPct < 30 ? 'badge-success' : uncertaintyPct < 50 ? 'badge-warning' : 'badge-danger';

                    tr.innerHTML = `
                        <td>${row.ds}</td>
                        <td><strong>${formatCurrency(row.yhat)}</strong></td>
                        <td>${formatCurrency(row.yhat_lower)}</td>
                        <td>${formatCurrency(row.yhat_upper)}</td>
                        <td><span class="status-badge ${badgeClass}">¬±${uncertaintyPct.toFixed(1)}%</span></td>
                    `;
                    forecastTable.appendChild(tr);
                });
            }
        }

        function formatCurrency(value) {
            return '$' + value.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }
    </script>
</body>
</html>
